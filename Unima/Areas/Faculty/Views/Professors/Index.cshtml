@using Unima.Areas.Faculty.Models.ViewModels
@model ProfessorViewModel
@{
	Layout = "/Areas/User/Views/Shared/_Layout.cshtml";
}
<link rel="stylesheet"
	  href="~/lib/md.bootstrappersiandatetimepicker/dist/mds.bs.datetimepicker.style.css" />
<link href="~/lib/timepicker/flatpickr.min.css" rel="stylesheet" />
<link rel="stylesheet" href="/css/faculty.css" />
<link rel="stylesheet" href="/css/Professor.css" />

<div class="container my-4">
	<div class="row justify-content-center mb-4">
		<div class="col-lg-7">
			<input type="text"
				   id="searchInput"
				   class="form-control text-center"
				   placeholder="جستجوی استاد..." />
		</div>
	</div>

	<div class="row gy-4" id="professors-list">
		@if (Model is not null)
		{
			foreach (var faculty in Model?.Professors?.Keys)
			{
				<div class="faculty-category">
					<h2 class="category-title">@faculty</h2>
					<div class="horizontal-scroll-wrapper">
						@foreach (var professor in Model.Professors[faculty])
						{
							<div class="professor-card-wrapper">
								<div class="card professor-card">
									<div class="close-btn">&times;</div>

									<div class="card-header-color">
										<img src="@professor.ProfileImageURL"
											 class="profile-img"
											 alt="تصویر استاد علی محمدی" />

										<div class="contact-details">
											<ul class="list-unstyled">
												<li>
													<i class="fas fa-envelope-open-text fa-fw"></i>
													<span>amirreza.amir34a@gmail.com</span>
												</li>
												<li>
													<i class="fas fa-map-marker-alt fa-fw"></i>
													<span>@professor.OfficeAddess</span>
												</li>
												<li>
													<i class="fas fa-clock fa-fw"></i>
													<span>@professor.Description</span>
												</li>
											</ul>
										</div>
										<div class="social-links expanded-social-links">
											<a href="#" title="وب‌سایت"><i class="fas fa-globe"></i></a>
											<a href="#" title="لینکدین"><i class="fab fa-linkedin"></i></a>
											<a href="@professor.Email" title="ایمیل">
												<i class="fas fa-envelope"></i>
											</a>
										</div>
									</div>

									<div class="card-body">
										<h5 class="card-title">@professor.FullName</h5>
										<p class="text-muted">@professor.Role</p>
										<span class="specialty-tag">@professor.Faculty - @professor.Department</span>
										<div class="social-links">
											<a href="#" title="وب‌سایت"><i class="fas fa-globe"></i></a>
											<a href="#" title="لینکدین"><i class="fab fa-linkedin"></i></a>
											<a href="@professor.Email" title="ایمیل">
												<i class="fas fa-envelope"></i>
											</a>
										</div>
									</div>

									<div class="expanded-content-wrapper">
										<div class="info-section">
											<h5 class="card-title">@professor.FullName</h5>
											<p class="text-muted">@professor.Role</p>
											<p class="biography">@professor.Bio</p>
											<div class="action-btn-wrapper">
												<button class="btn btn-primary reservationbtn"
														data-bs-toggle="modal"
														data-bs-target="#scheduleModal"
														data-tab-target="Reservation"
														onclick="loadProfessorData(@professor.Id)">
													رزرو وقت مشاوره
												</button>
											</div>
										</div>

										<div class="courses-section">
											<h6 class="section-title">دروس ارائه شده:</h6>
											<ul class="list-unstyled">
												@if (professor.Lessons is not null)
												{
													foreach (string lesson in
													@professor.Lessons)
													{
														<li><i class="fas fa-book ms-2"></i>@lesson</li>
													}
												}
											</ul>
											<div class="action-btn-wrapper">
												<button class="btn btn-outline-secondary coursebtn"
														data-bs-toggle="modal"
														data-bs-target="#scheduleModal"
														data-tab-target="schedule"
														onclick="loadProfessorData(@professor.Id)">
													نمایش برنامه کلاسی
												</button>
											</div>
										</div>
									</div>
								</div>
							</div>

						}
					</div>
				</div>

			}
		}
	</div>

	<div id="no-result" class="text-center mt-4" style="display: none">
		<h4 class="fw-light">استادی با این مشخصات یافت نشد.</h4>
	</div>
</div>

<div class="modal fade"
	 id="scheduleModal"
	 tabindex="-1"
	 aria-labelledby="exampleModalCenterTitle"
	 aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content bg-light">
			<div class="modal-header">
				<div class="modal-header-content d-flex align-items-center">
					<i class="fa-solid fa-chalkboard-teacher m-1 fs-5"></i>
					<span class="fs-6 m-1 w-100">اطلاعات‌ استاد</span>
				</div>
				<button type="button"
						class="btn-close m-0"
						data-bs-dismiss="modal"
						aria-label="close-tab"></button>
			</div>
			<div class="modal-body text-center">
				<div class="row tabs mb-4">
					<div class="col-6 tab" data-tab="Reservation">
						<div class="Professor-option border rounded p-2">
							<i class="fa-solid fa-calendar-plus d-block fs-4 mb-1"></i>
							<span class="fw-bold d-block">رزرو وقت</span>
						</div>
					</div>
					<div class="col-6 tab" data-tab="schedule">
						<div class="Professor-option border rounded p-2">
							<i class="fa-solid fa-calendar-week d-block fs-4 mb-1"></i>
							<span class="fw-bold d-block">برنامه کلاسی</span>
						</div>
					</div>
				</div>

				<div class="tab-content">
					<div class="tab-pane" id="schedule">
						<div class="checkboxes">
							<div class="checkbox-container">
								<input type="checkbox"
									   id="evenWeekCheck"
									   class="schedule-filter"
									   checked />
								<label for="evenWeekCheck" class="label-even">
									<span class="custom-checkbox">
										<i class="fa-solid fa-check"></i>
									</span>
									هفته زوج
								</label>
							</div>

							<div class="checkbox-container">
								<input type="checkbox"
									   id="oddWeekCheck"
									   class="schedule-filter"
									   checked />
								<label for="oddWeekCheck" class="label-odd">
									<span class="custom-checkbox">
										<i class="fa-solid fa-check"></i>
									</span>
									هفته فرد
								</label>
							</div>
						</div>
						<table class="scheduleTable table-bordered">
							<thead>
								<tr>
									<th>روز / ساعت</th>
									<th>06:00 - 08:00</th>
									<th>08:00 - 10:00</th>
									<th>10:00 - 12:00</th>
									<th>12:00 - 14:00</th>
									<th>14:00 - 16:00</th>
									<th>16:00 - 18:00</th>
									<th>18:00 - 20:00</th>
									<th>20:00 - 22:00</th>
								</tr>
							</thead>
							<tbody id="schedule-body"></tbody>
						</table>
					</div>

					<div class="tab-pane active" id="Reservation">
						<form class="text-end" id="ReservationForm" novalidate>
							<h5 class="border-bottom pb-1 mb-2">فرم رزرو وقت</h5>

							<div class="row">
								<div class="col-md-6 mb-2">
									<label for="subject" class="form-label">موضوع</label>
									<input type="text"
										   id="subject"
										   class="form-control"
										   required />
									<div class="invalid-feedback">وارد کردن موضوع الزامی است</div>
								</div>
								<div class="col-md-6 mb-2">
									<label for="locations" class="form-label">مکان</label>
									<select class="form-select" id="locations" required></select>
									<div class="invalid-feedback">
										وارد کردن مکان رزرو الزامی است
									</div>
								</div>
							</div>

							<div class="row">
								<div class="mb-1">
									<label for="description" class="form-label">توضیحات</label>
									<textarea class="form-control"
											  id="description"
											  rows="2"
											  required></textarea>
									<div class="invalid-feedback">
										وارد کردن توضیحات الزامی است
									</div>
								</div>
							</div>
							<div class="row">
								<div class="col-md-5 mb-2">
									<label for="date" class="form-label">تاریخ</label>
									<div class="input-group">
										<input type="text"
											   class="form-control"
											   id="date-input"
											   readonly />
										<button class="btn btn-outline-secondary btn-icon-center"
												type="button"
												id="calenderTriger">
											<i class="fa-solid fa-calendar-days"></i>
										</button>
									</div>
									<input type="hidden" id="hidden-date" />
									<div class="invalid-feedback">وارد کردن تاریخ الزامی است</div>
								</div>
								<div class="col-md-4 mb-2">
									<label for="my-inline-timepicker" class="form-label">ساعت</label>
									<div id="my-inline-timepicker"></div>
								</div>
								<div class="col-md-3 mb-3">
									<label for="duration" class="form-label">مدت زمان جلسه</label>
									<input type="number"
										   class="form-control"
										   id="duration"
										   min="10"
										   value="10"
										   step="5"
										   max="60"
										   required />
									<div class="invalid-feedback">مدت زمان را مشخص کنید.</div>
								</div>
							</div>
							<div class="row">
								<label for="fileUpload" class="form-label">آپلود فایل</label>
								<div class="col-md-12 mb-2 feature-disabled"
									 id="upload-container">
									<input type="file"
										   class="form-control"
										   id="fildUpload"
										   accept=".pdf,.doc,.docx,.png,.jpg" />
									<div id="filePreview" class="form-text text-muted">
										فایل انتخاب نشده است.
									</div>
								</div>
							</div>
							<div class="row">
								<button type="submit"
										class="btn btn-primary reservationbtn"
										id="submitReservationBtn">
									رزرو
								</button>
								<div class="invalid-feedback"></div>
							</div>
						</form>
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
					بستن
				</button>
			</div>
		</div>
	</div>
</div>
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
<script src="~/lib/md.bootstrappersiandatetimepicker/dist/mds.bs.datetimepicker.js"></script>
<script src="~/lib/timepicker/flatpickr.js"></script>
<script src="/js/Faculty.js"></script>
<script>
	document.addEventListener("DOMContentLoaded", function () {
	  const modalRoot = document.querySelector("#InformationProfessor");
	  if (!modalRoot) return;
	  const dialog = modalRoot.querySelector(".modal-dialog");
	  if (!dialog) return;

	  function forceReflow(el) {
		void el.offsetWidth;
	  }

	  function applyWide(shouldWide) {
		dialog.classList.toggle("modal-dialog-wide", shouldWide);
		forceReflow(dialog);
	  }

	  const getModalInst = () => bootstrap.Modal.getOrCreateInstance(modalRoot);

	  window.expandModal = function () {
		if (!modalRoot.classList.contains("show")) {
		  getModalInst().show();
		  setTimeout(() => applyWide(true), 60);
		} else applyWide(true);
	  };

	  window.shrinkModal = function () {
		if (!modalRoot.classList.contains("show")) {
		  getModalInst().show();
		  setTimeout(() => applyWide(false), 60);
		} else applyWide(false);
	  };

	  window.toggleModalSize = function () {
		applyWide(!dialog.classList.contains("modal-dialog-wide"));
	  };

	  modalRoot.addEventListener("hidden.bs.modal", () => applyWide(false));
	});
</script>
